
<%@page import="com.google.gson.Gson"%>
<%@page import="kr.or.ddit.dam.vo.MemVO"%>
<%@page import="kr.or.ddit.dam.mem.service.MemServiceImpl"%>
<%@page import="kr.or.ddit.dam.mem.service.IMemService"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BookDam</title>
  
   <script src="../js/jquery-3.7.1.js"></script>
   <script src="../js/jquery.serializejson.min.js"></script>
   <script src="../js/bookSearch.js"></script>
  
   <link rel="stylesheet" type="text/css" href="<%= request.getContextPath()%>/css/bookSearchCss.css">

  <script>
  	mypath = '<%= request.getContextPath()%>';
  	// mypath = BookDam
  	
  	currentPage = 1;
  	memMail = null;
  	
 <%
	MemVO mvo = (MemVO) session.getAttribute("loginOk");
	
	String user = null;
	Gson gson = new Gson();
	if (mvo != null) user = gson.toJson(mvo);
%>

	logUser = <%= user == null ? "null" : user %>;

	//ë¡œê·¸ì¸ í™•ì¸ìš© ì½˜ì†”ì°½
	if(logUser != null) {
		console.log("í˜„ì¬ ë¡œê·¸ì¸ID :" + logUser.mem_mail);
		memMail = logUser.mem_mail;
	} else {
		console.log("ë¡œê·¸ì¸ ìƒíƒœ : ë¹„íšŒì›");
		memMail = null;
	}

	////////////////// ë‹¤ë¥¸ í˜ì´ì§€ì—ë„ í•„ìˆ˜ë¡œ ë„£ì–´ì•¼ í•˜ëŠ” ì´ë²¤íŠ¸ //////////////////
	// ë¡œê·¸ì•„ì›ƒ (í•„ìˆ˜)
	const logout = async () =>{
		
		try{
			response = await fetch('/BookDam/Logout.do');
			if(!response.ok){
				throw new Error('ì„œë²„ì˜¤ë¥˜:' + response.status);
			}
			result = await response.json();
			
			if(result&& result.flag === 'ok') {
				alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
				sessionStorage.removeItem('cartArr');
				window.location.href = `../main/bookdam_main.jsp`;
			} else {
				alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨");
			}
		}catch(error){
			console.error("ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨ : " , error);
			alert("ì˜¤ë¥˜ë°œìƒ")
		}
	}
	
	// íšŒì› / ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒ
	const goOrderList = () => {
		if (logUser != null) {
			location.href= mypath + '/order/order_list.jsp';		
		} else {
			location.href= `\${mypath}/log/login.jsp`	
		}
	}
	////////////////////////////////////////////////////////////////////

  	$(function() {
	//////////////// ë‹¤ë¥¸ í˜ì´ì§€ì—ë„ í•„ìˆ˜ë¡œ ë„£ì–´ì•¼ í•˜ëŠ” ì´ë²¤íŠ¸ //////////////////
	  	// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (í•„ìˆ˜)
	    $('#search-btn').on('click', function() {  
		  
	    	const stype = $('#stype').val();
			const sword = $('#sword').val().trim();
			$('#sword-result').text(sword || 'ì „ì²´');
			
			console.log(stype, sword);
		    
		    currentPage = 1;
		    console.log("ê²€ìƒ‰ë²„íŠ¼ í´ë¦­");
		    location.href = `<%=request.getContextPath()%>/bookSearch/bookSearchRes.jsp?stype=\${stype}&sword=\${sword}&sortType=popularity&currentPage=1`;
	 	});
	 	
	    $('#sword').on('keydown', function(e) {
			if(e.keyCode == 13 || e.which == 13) {
		        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
		        $('#search-btn').click();
		    }
		});
	////////////////////////////////////////////////////////////////////
  		
  	})

  </script>
</head>
  
<body>

    <!-- ìƒë‹¨ë°” (ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ê¸°) -->
    <header class="header">
        <div class="header-content">
        	<div class="mypage-header">
        		<% if(mvo == null){ %>
                	<a href="../log/login.jsp" onclick="alert('ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™')">ë¡œê·¸ì¸</a>
           		<%}else{ %>
           			<a href="javascript:void(0);" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
           		<% } %>
           		<a href="#" onclick="alert('ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™')">ë§ˆì´í˜ì´ì§€</a>
        	</div>
        	<div class="top-header">

	            <!-- ê²€ìƒ‰ ì˜ì—­ -->
		        <section class="search-section">
		        	<div class="search-container">
		        	<div class="logo">ğŸ“š ë¶ë‹´</div>
			            <!-- <form class="search-form" onsubmit="handleSearch(event)"> -->
			            <form class="search-form">
			                <select class="search-category" id="stype">
			                    <option value="all">ì „ì²´</option>
			                    <option value="title">ë„ì„œëª…</option>
			                    <option value="author">ì €ì</option>
			                    <option value="publisher">ì¶œíŒì‚¬</option>
			                </select>
			                <input type="text" class="search-input" id="sword"
			                       placeholder="ê²€ìƒ‰í•  ë„ì„œëª… ë˜ëŠ” ì €ì ë˜ëŠ” ì¶œíŒì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
			                <button id="search-btn" type="button" class="search-btn">ğŸ”</button>
			             </form>
		             
			             <!-- í—¤ë” ì•„ì´ì½˜ë“¤ -->
			             <div class="header-icons">
			                <button onclick='goOrderList()' class="icon-btn" title="ì°œëª©ë¡">â¤ï¸</button>
			              	<!--<button class="icon-btn" title="ì¥ë°”êµ¬ë‹ˆ">ğŸ›’</button>-->
			                <button onclick="location.href= mypath + '/cart/cart_page.jsp'" class="icon-btn" title="ì¥ë°”êµ¬ë‹ˆ" >ğŸ›’</button>
			             </div>
		             </div>
		        </section> 
        	</div>
        	
        </div>
    </header>
        	<!-- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
            <nav class="nav-menu">
                <a href="#" onclick="alert('ì„œì ì´ìš©ì•ˆë‚´ í˜ì´ì§€ë¡œ ì´ë™')">ì„œì ì´ìš©ì•ˆë‚´</a>
                <a href="<%= request.getContextPath()%>/bookSearch/bookBestseller.jsp">ë² ìŠ¤íŠ¸ì…€ëŸ¬</a>
                <a href="#" onclick="alert('ë¬¸í™”/í–‰ì‚¬ í˜ì´ì§€ë¡œ ì´ë™')">ë¬¸í™”/í–‰ì‚¬</a>
                <a href="#" onclick="alert('ê³µì§€ì‚¬í•­ í˜ì´ì§€ë¡œ ì´ë™')">ê³µì§€ì‚¬í•­</a>
                <a href="<%=request.getContextPath() %>/QnaList.do" onclick="alert('ê³ ê°ì„¼í„° í˜ì´ì§€ë¡œ ì´ë™')">ê³ ê°ì„¼í„°</a> 
            </nav>
        
    <hr id="nav-bottom">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">


    </div> <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ ëë‚¨ -->
       
</body>
</html>